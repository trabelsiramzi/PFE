(window.webpackJsonpb6917cb1_93a0_4b97_a84d_7cf49975d4ec_0_2_0=window.webpackJsonpb6917cb1_93a0_4b97_a84d_7cf49975d4ec_0_2_0||[]).push([[82],{SYdo:function(e,t,n){"use strict";n.r(t),n.d(t,"pageMode",function(){return U}),n.d(t,"DwellTime",function(){return j}),n.d(t,"DwellTimeSignalType",function(){return a}),n.d(t,"DwellTimeTelemetry",function(){return F});var a,i,r=n("17wl"),o=n("K9kD"),s=n("dq6a"),c=n("gM97"),d=n("Gu0Z"),l=n("3HEj"),u={method:"POST",noRedirect:!0},f=function(e){function t(t,n){var a=e.call(this,{dataSourceName:"PageActivities"},{pageContext:t})||this;return n?a._getToken=n:(a._tokenProvider=new c.e(null,{oAuthTokenDataSource:new d.e(t)}),a._getToken=function(e,t){return a._tokenProvider.getToken(e,t)}),a}return Object(r.__extends)(t,e),t.prototype.postPageActivities=function(e){var t=this,n=this._getBaseUrl(),a=new o.Qos({name:"dwellFetchToken"});return this._getToken(Object(l.r)(this._pageContext)).then(function(i){a.end({resultType:o.ResultTypeEnum.Success});var s=new o.Qos({name:"sendPageActivitiesSync"}),c="".concat(n,"/").concat("pages/oneDrive.sendActivities"),d={value:e},l=t.dataRequestor.getData(Object(r.__assign)({url:c,authToken:i,qosName:"sendPageActivities",additionalPostData:JSON.stringify(d),additionalHeaders:{accept:"application/json"}},u));return s.end({resultType:o.ResultTypeEnum.Success}),l},function(e){return a.end({resultCode:e,resultType:o.ResultTypeEnum.Failure}),e})},t.prototype._getBaseUrl=function(e){var t=this._getAPIBaseUrl(e),n=new o.Uri(t).getAuthority(),a=o.Guid.normalizeLower(this._pageContext.siteId,!1),i=o.Guid.normalizeLower(this._pageContext.webId,!1);return"".concat(t,"/sites/").concat(n,",").concat(a,",").concat(i)},t.prototype._getAPIBaseUrl=function(e){var t=Object(l.r)(this._pageContext);return e=e||"2.1","".concat(t,"/_api/v").concat(e)},t}(s.t),p="DWELL_TIME",m="LAST_DWELL_TIME_SENT",_="DWELL_TIME_10_SEC",h="LAST_DWELL_TIME_SENT_10_SEC",b="DWELL_TIME_30_SEC",g="LAST_DWELL_TIME_SENT_30_SEC",v="DWELL_TIME_1_MIN",y="LAST_DWELL_TIME_SENT_1_MIN",S="DWELL_TIME_2_MIN",D="LAST_DWELL_TIME_SENT_2_MIN",I="DWELL_TIME_3_MIN",x="LAST_DWELL_TIME_SENT_3_MIN",C=3e5,O=12e4,w=18e4,E=o.Features.isFeatureEnabled({ODB:1794}),A=o.Features.isFeatureEnabled({ODB:1795}),L=o.Features.isFeatureEnabled({ODB:1694}),k=o.Features.isFeatureEnabled({ODB:1361}),M=o.Features.isFeatureEnabled({ODB:1727}),P=o.Features.isFeatureEnabled({ODB:1782}),T=o.Features.isFeatureEnabled({ODB:1899});!function(e){e.PageActivities="PageActivities"}(a||(a={})),function(e){e.HomePage="HomePage",e.ArticlePage="ArticlePage",e.ModernPage="ModernPage",e.ClassicPage="ClassicPage",e.NewsPage="NewsPage",e.NewsDigestPage="NewsDigestPage",e.Space="Space"}(i||(i={}));var U,F=function(){function e(){}return e.initialize=function(t,n,a,i){var r;if(e.disableDwellInitMonitorsKSActivated()&&(r=new o.Qos({name:"DwellTimeTelemetryInitialization"})),e.sessionId=t,e.initializationTimestamp=e.initializationTimestamp||Date.now(),e.initializeLocalStorage=!0,e.ariaKeyPrefix=n,a){e.pageContext=a,e.PageActivitiesDatSource=new f(a,i);try{var s=a.systemUserKey;if(s){var c=s.lastIndexOf("|")+1,d=-1===s.indexOf("@")?s.length:s.indexOf("@");e.userId=s.substring(c,d)}}catch(t){e._handleException(t&&t.message)}}this.sendEvents(),this._initializeForDiffIntervals(p,m),E&&(this._initializeForDiffIntervals(_,h),this._initializeForDiffIntervals(v,y),this._initializeForDiffIntervals(S,D),this._initializeForDiffIntervals(I,x)),A&&this._initializeForDiffIntervals(b,g),e.initializeLocalStorage=!1,T&&e._isIncognitoBrowser().then(function(t){e.isIncognitoBrowser=t}),e.disableDwellInitMonitorsKSActivated()&&(null==r||r.end({resultType:o.ResultTypeEnum.Success}))},e.bufferDwellTimeIntervals=function(){this._bufferDwellTimeIntervalsForDiffIntervals(p,m,C),E&&(this._bufferDwellTimeIntervalsForDiffIntervals(_,h,1e4),this._bufferDwellTimeIntervalsForDiffIntervals(v,y,6e4),this._bufferDwellTimeIntervalsForDiffIntervals(S,D,O),this._bufferDwellTimeIntervalsForDiffIntervals(I,x,w)),A&&this._bufferDwellTimeIntervalsForDiffIntervals(b,g,3e4)},e.sendEvents=function(){this._sendEventsForDiffIntervals(p,m,C),E&&(this._sendEventsForDiffIntervals(_,h,1e4),this._sendEventsForDiffIntervals(v,y,6e4),this._sendEventsForDiffIntervals(S,D,O),this._sendEventsForDiffIntervals(I,x,w)),A&&this._sendEventsForDiffIntervals(b,g,3e4)},e.logInitialPageLoadEvent=function(t){t&&o.Engagement.withContext(e._getAriaEventContext(e.sessionId,t.extraPageData)).logData({name:"DwellTime_InitialPageLoad",currentPage:t.pageId,extraData:{pageType:t.pageType,dwellLibVersion:2,uniqueKeyIdentifier:e._getUniqueKeyIdentifier(e.sessionId,e.initializationTimestamp,t.pageId),incognitoBrowser:e.isIncognitoBrowser,sessionInitTime:e.initializationTimestamp,startTime:performance.now()}})},e.disableDwellInitMonitorsKSActivated=function(){return o.Killswitch.isActivated("7f3f5cda-0a1a-46dd-922e-56b5db4a7031","10/08/2020","Stage always success QoS monitors for removal.")},e._getPageActivity=function(e,t,n,a){var i=t.page.extraPageData,r=n&&n[n.length-1].stop||0;return{sharepointIds:{siteId:i&&i.siteId&&i.siteId.toString()||"",webId:i&&i.webId&&i.webId.toString()||"",listId:i&&i.listId&&i.listId.toString()||"",listItemUniqueId:t.page.pageId},webTemplateId:i&&i.webTemplateId&&i.webTemplateId.toString()||"",operation:"PageActivities",pageType:t.page.pageType||"",totalDwellTimeMs:j.calculateTotalDwellTimeFromIntervals(n),totalTimeMs:j.calculateTotalTimeFromIntervals(n),dwellFrequency:n&&n.length||0,pageReadPercentage:t.page.percentageRead,clientSessionId:e,pageMode:a,lastActivityDateTime:new Date(r).toISOString()}},e._sendAriaEvent=function(t,n,i,r,s,c){var d=n.page.extraPageData,l=i&&i[i.length-1].stop||0;o.Engagement.withContext(e._getAriaEventContext(t,n.page&&d)).logData({name:e.ariaKeyPrefix+a.PageActivities+s,currentPage:n.page.pageId,extraData:{intervals:JSON.stringify(i),totalDwellTime:j.calculateTotalDwellTimeFromIntervals(i),pageType:n.page.pageType,pageReadPercentage:n.page.percentageRead,totalTime:j.calculateTotalTimeFromIntervals(i),dwellFrequency:i&&i.length||0,pageMode:r,lastActivityDateTime:l?new Date(l).toISOString():"",dwellLibVersion:2,uniqueKeyIdentifier:e._getUniqueKeyIdentifier(t,c,n.page.pageId),incognitoBrowser:e.isIncognitoBrowser,sessionInitTime:c}})},e._getAriaEventContext=function(e,t){var n={"AppInfo.Session":e};return t&&(t.siteId&&(n.SiteId=t.siteId.toString()),t.webId&&(n.WebId=t.webId.toString()),t.webTemplateId&&(n.WebTemplateId=t.webTemplateId.toString()),t.listId&&(n.ListId=t.listId.toString())),n},e._validateStorgeSizeAndCleanup=function(t,n,a){var i=localStorage.getItem(t);i&&2*i.length>=51200&&e._sendEventsForDiffIntervals(t,n,a,!0)},e._initializeForDiffIntervals=function(t,n){var a;if(e.disableDwellInitMonitorsKSActivated()&&(a=new o.Qos({name:"DwellLocalStorageSet".concat(t)})),!e.initializeLocalStorage&&!localStorage.getItem(t)){var i=j.getDwellTimeSettings()&&j.getDwellTimeSettings().page&&j.getDwellTimeSettings().page.pageId;o.Engagement.logData({name:"Dwell_Time_LocalStorage_Cleared",currentPage:i,extraData:{key:t,dwellLibVersion:2,uniqueKeyIdentifier:e._getUniqueKeyIdentifier(e.sessionId,e.initializationTimestamp,i),incognitoBrowser:e.isIncognitoBrowser,sessionInitTime:e.initializationTimestamp}})}var r=localStorage.getItem(t)||"{}",s=JSON.parse(r);s[e.sessionId]||(s[e.sessionId]={},s[e.sessionId].initializationTimestamp=e.initializationTimestamp,e._localStorageSetItem(t,JSON.stringify(s))),localStorage.getItem(n)||e._localStorageSetItem(n,Date.now().toString()),e.disableDwellInitMonitorsKSActivated()&&(null==a||a.end({resultType:o.ResultTypeEnum.Success}))},e._bufferDwellTimeIntervalsForDiffIntervals=function(t,n,a,i){e._validateStorgeSizeAndCleanup(t,n,a),e._initializeForDiffIntervals(t,n);var r=localStorage.getItem(t);if(r){var o=JSON.parse(r);o[e.sessionId][j.getPageId()]||(o[e.sessionId][j.getPageId()]={readIntervals:[],editIntervals:[],page:j.getDwellTimeSettings().page});var s=o[e.sessionId][j.getPageId()].percentageRead;s&&j.getPageReadPercentage()>s&&(o[e.sessionId][j.getPageId()].percentageRead=j.getPageReadPercentage()),j.isEditMode()?Array.prototype.push.apply(o[e.sessionId][j.getPageId()].editIntervals,j.getDwellTimeEditIntervals()):Array.prototype.push.apply(o[e.sessionId][j.getPageId()].readIntervals,j.getDwellTimeReadIntervals()),e._localStorageSetItem(t,JSON.stringify(o))||i||(e._sendEventsForDiffIntervals(t,n,a,!0),e._bufferDwellTimeIntervalsForDiffIntervals(t,n,a,!0))}},e._sendEventsForDiffIntervals=function(t,n,a,i){var r;e.disableDwellInitMonitorsKSActivated()&&(r=new o.Qos({name:"DwellSendEvents".concat(t)}));var s=localStorage.getItem(n);if(Date.now()-(s?parseInt(s,10):0)>a||i){var c=localStorage.getItem(t);if(c){var d=JSON.parse(c),l=[],u=e.pageContext&&a===C;for(var f in d)if(d.hasOwnProperty(f)){var p=d[f];if(p){var m=p.initializationTimestamp;for(var _ in p)if(p.hasOwnProperty(_)&&"initializationTimestamp"!==_){var h=p[_],b=h.page.pageType;if(this._isAriaEnabled(b)){var g=a===C?"":"."+a/1e3+"s";h.editIntervals&&h.editIntervals.length>0&&e._sendAriaEvent(f,h,h.editIntervals,U.EDIT,g,m),h.readIntervals&&h.readIntervals.length>0&&e._sendAriaEvent(f,h,h.readIntervals,U.READ,g,m)}u&&this._isSPOEnabled(b)&&(h.editIntervals&&h.editIntervals.length>0&&l.push(e._getPageActivity(f,h,h.editIntervals,U.EDIT)),h.readIntervals&&h.readIntervals.length>0&&l.push(e._getPageActivity(f,h,h.readIntervals,U.READ)))}}}l.length>0&&e.PageActivitiesDatSource.postPageActivities(l)}e._localStorageSetItem(t,"{}"),e._localStorageSetItem(n,Date.now().toString())}e.disableDwellInitMonitorsKSActivated()&&(null==r||r.end({resultType:o.ResultTypeEnum.Success}))},e._isAriaEnabled=function(e){switch(e){case i.NewsPage:case i.HomePage:return L;case i.ArticlePage:return M;default:return!1}},e._isSPOEnabled=function(e){switch(e){case i.NewsPage:case i.HomePage:return k;case i.ArticlePage:return P;default:return!1}},e._localStorageSetItem=function(t,n){try{return localStorage.setItem(t,n),!0}catch(d){var a=2*n.length/1024,i=e._getLocalStorageSize(),r=j.getDwellTimeSettings()&&j.getDwellTimeSettings().page,s=r&&r.extraPageData,c=r&&r.pageId;return o.Engagement.withContext(e._getAriaEventContext(e.sessionId,s)).logData({name:"Dwell_Time_SetItem_Failed",currentPage:c,extraData:{key:t,dwellKeySize:a,localStorageSize:i,message:d&&d.message,dwellLibVersion:2,uniqueKeyIdentifier:e._getUniqueKeyIdentifier(e.sessionId,e.initializationTimestamp,c),incognitoBrowser:e.isIncognitoBrowser,sessionInitTime:e.initializationTimestamp}}),!1}},e._getLocalStorageSize=function(){var e="";for(var t in window.localStorage)window.localStorage.hasOwnProperty(t)&&(e+=t+window.localStorage[t]);return e?2*e.length/1024:0},e._getUniqueKeyIdentifier=function(t,n,a){var i=t;return e.userId&&(i=i+"_"+e.userId),n&&(i=i+"_"+n),a&&(i=i+"_"+a),i},e._isIncognitoBrowser=function(){return Object(r.__awaiter)(this,void 0,void 0,function(){var e;return Object(r.__generator)(this,function(t){switch(t.label){case 0:return"storage"in navigator&&"estimate"in navigator.storage?[4,navigator.storage.estimate()]:[3,2];case 1:return void 0!==(e=t.sent().quota)&&e<12e7?[2,!0]:[2,!1];case 2:return[2,!1];case 3:return[2]}})})},e._handleException=function(t){var n=j.getDwellTimeSettings()&&j.getDwellTimeSettings().page,a=n&&n.extraPageData,i=n&&n.pageId;o.Engagement.withContext(e._getAriaEventContext(e.sessionId,a)).logData({name:"Dwell_Time_Exception",currentPage:i,extraData:{message:t,dwellLibVersion:2,uniqueKeyIdentifier:e._getUniqueKeyIdentifier(e.sessionId,e.initializationTimestamp,i),incognitoBrowser:e.isIncognitoBrowser,sessionInitTime:e.initializationTimestamp}})},e}(),H=o.Features.isFeatureEnabled({ODB:674});!function(e){e.READ="READ",e.EDIT="EDIT"}(U||(U={}));var R=["scroll","resize"],N=["keyup","keydown","touchstart","click","contextmenu"],B="locationChange",j=function(){function e(){}return e.initialize=function(t){var n;F.disableDwellInitMonitorsKSActivated()&&(n=new o.Qos({name:"DwellTimeLibraryInitialization"})),e.reset(),e.running=!1,e.pageReadPercentage=0,e.idle=!1,e.readIntervals=[],e.editIntervals=[],e.currentIdleTimeMs=0,e.dwellTimeSettings=t,e.mouseInactiveTime=t.mouseInactiveTime||3e4,e.checkCallbacksIntervalMs=100,e.totalEditDwellTime=0,e.totalReadDwellTime=0,e.historyPushState=history.pushState,e.historyReplaceState=history.replaceState,e.extraPageData=t.page.extraPageData,e._registerEventListeners(),e.startTimer(),F.logInitialPageLoadEvent(t.page),F.disableDwellInitMonitorsKSActivated()&&(null==n||n.end({resultType:o.ResultTypeEnum.Success}))},e.isRunning=function(){return this.running},e.startTimer=function(){e.checkCallbackIntervalId||e._checkCallbacksOnInterval();var t=e._getIntervals(),n=t[t.length-1];n&&null===n.stop||(t.push({start:Date.now(),stop:null}),e.running=!0)},e.stopTimer=function(){var t=e._getIntervals();t.length&&(t[t.length-1].stop=Date.now(),e.running=!1,(e.dwellTimeSettings.sendAriaEvents||e.dwellTimeSettings.sendSPOEvents)&&(F.bufferDwellTimeIntervals(),e._updateTotalEditDwellTime(),e._updateTotalReadDwellTime(),e.readIntervals=[],e.editIntervals=[],F.sendEvents()))},e.getTimeInMilliseconds=function(){return e.getEditDwellTimeInMilliseconds()+e.getReadDwellTimeInMilliseconds()},e.getEditDwellTimeInMilliseconds=function(){return e.totalEditDwellTime+e.calculateTotalDwellTimeFromIntervals(e.editIntervals)},e.getReadDwellTimeInMilliseconds=function(){return e.totalReadDwellTime+e.calculateTotalDwellTimeFromIntervals(e.readIntervals)},e.calculateTotalDwellTimeFromIntervals=function(e){return e.length>0?e.reduce(function(e,t){return t.stop?e+=t.stop-t.start:e+=Date.now()-t.start,e},0):0},e.calculateTotalTimeFromIntervals=function(e){if(e&&e.length>0){var t=e[e.length-1],n=e[0];if(t.stop)return t.stop-n.start}return 0},e.getTimeInSeconds=function(t){return t?Number((e.getTimeInMilliseconds()/1e3).toFixed(t)):e.getTimeInMilliseconds()/1e3},e.isEditMode=function(){return!(!e.extraPageData||!e.extraPageData.pageMode||e.extraPageData.pageMode!==U.EDIT)},e.getDwellTimeEditIntervals=function(){return e.editIntervals},e.reset=function(){e.isRunning()&&e.stopTimer(),e.readIntervals=[],e.editIntervals=[],e._destroy()},e.getDwellTimeReadIntervals=function(){return e.readIntervals},e.getPageId=function(){return e.dwellTimeSettings.page.pageId},e.getPageReadPercentage=function(){return e.pageReadPercentage},e.getDwellTimeSettings=function(){return e.dwellTimeSettings},e.registerScrollListener=function(t){if(t){e.scrollDivClass=t;var n=document.getElementsByClassName(t);n&&n[0]&&(n[0].addEventListener("scroll",e._findPageReadPercentage,{passive:!0}),n[0].addEventListener("scroll",e._onBrowserTabInactive,{passive:!0}))}},e.updatePageMode=function(t){e.stopTimer(),e.extraPageData||(e.extraPageData={}),e.extraPageData.pageMode=t,e.startTimer()},e.isEditDwellTimeKSActivated=function(){return!1},e._getIntervals=function(){return e.isEditMode()?e.editIntervals:e.readIntervals},e._updateTotalEditDwellTime=function(){e.totalEditDwellTime=e.getEditDwellTimeInMilliseconds()},e._updateTotalReadDwellTime=function(){e.totalReadDwellTime=e.getReadDwellTimeInMilliseconds()},e._onBrowserTabInactive=function(t){e.running&&e.stopTimer()},e._onBrowserTabActive=function(t){e.running||e.startTimer()},e._resetIdleTime=function(t){e.idle&&e.startTimer(),e.idle=!1,e.currentIdleTimeMs=0},e._resetIdleTimeWithStartTimer=function(t){e._resetIdleTime(t),e.running||e.startTimer()},e._registerEventListeners=function(){var t={passive:!0};window.addEventListener("blur",e._onBrowserTabInactive,t),window.addEventListener("focus",e._onBrowserTabActive,t),window.addEventListener("unload",e._onBrowserTabInactive,t),R.forEach(function(n){window.addEventListener(n,e._resetIdleTime,t)}),document.body.addEventListener("mouseleave",e._onBrowserTabInactive,t),document.addEventListener("mousemove",e._resetIdleTimeWithStartTimer,t),N.forEach(function(n){document.addEventListener(n,e._resetIdleTime,t)}),e._addLocationChangeListener()},e._dwellPushState=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var a=e.historyPushState.apply(history,t);if(e.isRunning()){var i=document.createEvent("Event");i.initEvent(B,!0,!0),window.dispatchEvent(i)}return a},e._dwellReplaceState=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var a=e.historyReplaceState.apply(history,t);if(e.isRunning()){var i=document.createEvent("Event");i.initEvent(B,!0,!0),window.dispatchEvent(i)}return a},e._addLocationChangeListener=function(){var t={passive:!0};H&&(history.pushState=e._dwellPushState,history.replaceState=e._dwellReplaceState),window.addEventListener("popstate",e._onBrowserTabInactive,t),window.addEventListener(B,e._onBrowserTabInactive,t)},e._checkCallbacksOnInterval=function(){e.checkCallbackIntervalId=window.setInterval(function(){e.currentIdleTimeMs>=e.mouseInactiveTime&&e.running?(e.idle=!0,e.stopTimer()):e.currentIdleTimeMs+=e.checkCallbacksIntervalMs},e.checkCallbacksIntervalMs)},e._destroy=function(){e._unregisterEventListeners(),e.checkCallbackIntervalId&&(window.clearInterval(e.checkCallbackIntervalId),e.checkCallbackIntervalId=0),H&&e.historyPushState&&e.historyReplaceState&&(history.pushState===e._dwellPushState&&(history.pushState=e.historyPushState),history.replaceState===e._dwellReplaceState&&(history.replaceState=e.historyReplaceState))},e._unregisterEventListeners=function(){if(window.removeEventListener("blur",e._onBrowserTabInactive),window.removeEventListener("popstate",e._onBrowserTabInactive),window.removeEventListener(B,e._onBrowserTabInactive),window.removeEventListener("unload",e._onBrowserTabInactive),window.removeEventListener("focus",e._onBrowserTabActive),R.forEach(function(t){window.removeEventListener(t,e._resetIdleTime)}),document.body.removeEventListener("mouseleave",e._onBrowserTabInactive),document.removeEventListener("mousemove",e._resetIdleTimeWithStartTimer),N.forEach(function(t){document.removeEventListener(t,e._resetIdleTime)}),e.scrollDivClass){var t=document.getElementsByClassName(e.scrollDivClass);t&&t[0]&&(t[0].removeEventListener("scroll",e._findPageReadPercentage),t[0].removeEventListener("scroll",e._onBrowserTabInactive))}},e._findPageReadPercentage=function(t){var n=t.target,a=n.clientHeight,i=n.scrollHeight-a,r=n.scrollTop;if(0===r&&0===i)return 100;var o=Math.floor(r/i*100);return o>e.pageReadPercentage&&(e.pageReadPercentage=o),o},e}()}}]);