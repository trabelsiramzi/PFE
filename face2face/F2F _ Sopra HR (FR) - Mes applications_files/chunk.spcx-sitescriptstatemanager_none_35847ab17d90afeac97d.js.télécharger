(window.webpackJsonp_1e2cdec9_1360_4295_b73c_98d6f51866d5_0_1_0=window.webpackJsonp_1e2cdec9_1360_4295_b73c_98d6f51866d5_0_1_0||[]).push([[8],{"6cSr":function(e,t,n){"use strict";n.d(t,"e",function(){return r});var a,i,r={Success:0,Failure:1,NoOp:2,SuccessWithException:3,Started:4};!function(e){e[e.Tenant=0]="Tenant",e[e.OutOfBox=1]="OutOfBox"}(a||(a={})),function(e){e[e.Default=0]="Default",e[e.JoinHubSite=1]="JoinHubSite",e[e.WebAction=2]="WebAction",e[e.CreateFromTemplate=3]="CreateFromTemplate",e[e.OOBSiteDesign=4]="OOBSiteDesign",e[e.ListDesign=5]="ListDesign"}(i||(i={}))},qQzT:function(e,t,n){"use strict";n.r(t),n.d(t,"SiteScriptProgressCallbackType",function(){return a}),n.d(t,"SiteScriptRunAge",function(){return i}),n.d(t,"SiteScriptProgressStateManager",function(){return h});var a,i,r=n("17wl"),o=n("K9kD"),s=n("6cSr"),c=n("dq6a"),d=n("y88i"),l=function(e){function t(t){return e.call(this,{dataSourceName:"SiteScriptProgressDataSource"},{pageContext:t.pageContext})||this}return Object(r.__extends)(t,e),t.prototype.getDesignPackageMenuContents=function(){return this.getData(this._constructGetDesignPackageMenuContentsUrl.bind(this),function(e){return JSON.parse(e)},"GetDesignPackageMenuContentsAPI")},t.prototype.getSiteDesignTasks=function(){var e=this;return this.getData(this._constructGetSiteDesignTasksUrl.bind(this),function(e){return JSON.parse(e)},"GetSiteDesignTasksAPI",function(){return JSON.stringify({webUrl:d.UriEncoding.escapeUrlForCallback(e._pageContext.webAbsoluteUrl)})})},t.prototype.addSiteDesignTask=function(e){return this.getData(this._constructAddSiteDesignTaskUrl.bind(this),function(e){return JSON.parse(e)},"AddSiteDesignTaskAPI",function(){return JSON.stringify({siteDesignId:e})})},t.prototype.getSiteDesignRunStatus=function(e){return this.getData(this._constructGetSiteDesignRunStatusUrl.bind(this),function(e){return JSON.parse(e)},"GetSiteDesignRunStatusAPI",function(){return JSON.stringify({runId:e})})},t.prototype.getSiteDesignRuns=function(){return this.getData(this._constructGetSiteDesignRunsUrl.bind(this),function(e){return JSON.parse(e)},"GetSiteDesignStagesAPI")},t.prototype.getSiteDesignStages=function(e){return this.getData(this._constructGetSiteDesignStagesUrl.bind(this),function(e){return JSON.parse(e)},"GetSiteDesignStagesAPI",function(){return JSON.stringify({siteDesignId:e})})},t.prototype.applySiteDesign=function(e,t){var n=this;return this.getData(this._constructApplySiteDesignUrl.bind(this),function(e){return JSON.parse(e)},"ApplySiteDesignAPI",function(){return JSON.stringify({siteDesignId:e,webUrl:n._pageContext.webAbsoluteUrl,store:t})})},t.prototype.getTenantSiteDesigns=function(){return this.getData(this._consturctGetTenantSiteDesignsUrl.bind(this),function(e){return JSON.parse(e)},"GetTenantSiteDesignsAPI")},t.prototype.getOutOfBoxSiteDesigns=function(){return this.getData(this._consturctGetOutOfBoxSiteDesignsUrl.bind(this),function(e){return JSON.parse(e)},"GetOutOfBoxSiteDesignsAPI")},t.prototype.getIsSiteDesignPending=function(){return this.getData(this._constructValidateSiteDesignPendingUrl.bind(this),function(e){return JSON.parse(e)},"ValidateSiteDesignPendingAPI")},t.prototype.applyImplicitSiteDesign=function(){this.getData(this._constructApplyImplicitSiteDesignUrl.bind(this),function(e){return e},"ApplyImplicitSiteDesignAPI")},t.prototype.getOutOfBoxTemplateSettings=function(){return this.getData(this._constructGetOutOfBoxTemplateSettingsUrl.bind(this),function(e){return JSON.parse(e)},"GetOutOfBoxTemplateSettingsAPI")},t.prototype._constructGetDesignPackageMenuContentsUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetDesignPackageMenuContents")},t.prototype._constructGetSiteDesignTasksUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetSiteDesignTasks")},t.prototype._constructAddSiteDesignTaskUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.AddSiteDesignTaskToCurrentWeb")},t.prototype._constructGetSiteDesignRunStatusUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetSiteDesignRunStatusAndSchema")},t.prototype._constructGetSiteDesignRunsUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetSiteDesignRun")},t.prototype._constructGetSiteDesignStagesUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetSiteDesignStages")},t.prototype._constructApplySiteDesignUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.ApplySiteDesign")},t.prototype._consturctGetTenantSiteDesignsUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetSiteDesigns")},t.prototype._consturctGetOutOfBoxSiteDesignsUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetSiteDesigns?store=1")},t.prototype._constructValidateSiteDesignPendingUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.ValidatePendingWebTemplateExtension")},t.prototype._constructApplyImplicitSiteDesignUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.ApplyImplicitSiteDesign")},t.prototype._constructGetOutOfBoxTemplateSettingsUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetOutOfBoxSiteTemplateSettings")},t.prototype._constructGenericUrl=function(e){return new o.Uri(o.Uri.concatenate(d.UriEncoding.escapeUrlForCallback(this._pageContext.webServerRelativeUrl),e)).toString()},t}(c.t),u={ODB:60625},f=function(){function e(e){this._dataSource=e.dataSource,this._currentCultureName=e.currentCultureName}return e.prototype.getSiteDesignRunStatus=function(e,t){var n=this;return this._dataSource.getSiteDesignRunStatus(e).then(function(e){var a=[],i=e&&e.d&&e.d.GetSiteDesignRunStatusAndSchema&&e.d.GetSiteDesignRunStatusAndSchema.ActionStatus&&e.d.GetSiteDesignRunStatusAndSchema.ActionStatus.results;if(i&&i.length)for(var r=0;r<i.length;r++){var o=i[r];n._templateHistoryEnabled()?a.push({outcomeCode:o.OutcomeCode,outcomeText:o.OutcomeText,ordinalIndex:o.OrdinalIndex,actionIndex:o.ActionIndex}):a.push({outcomeCode:o.OutcomeCode,outcomeText:o.OutcomeText})}var s=void 0;return t&&e.d.GetSiteDesignRunStatusAndSchema.Schema&&(s=n._constructSiteScriptData(e.d.GetSiteDesignRunStatusAndSchema.Schema,void 0)),{siteScriptData:s,stageResultData:a}})},e.prototype.getSiteDesignRuns=function(){var e=this;return this._dataSource.getSiteDesignRuns().then(function(t){var n=[];if(t&&t.d&&t.d.results)for(var a=0;a<t.d.results.length;a++){var i=t.d.results[a],r=parseInt(i.StartTime,10);n.push({siteDesignId:i.SiteDesignID,siteDesignTitle:i.SiteDesignTitle,runId:i.ID,version:i.SiteDesignVersion,runDate:isNaN(r)?"":new Date(r).toLocaleDateString(e._currentCultureName),invokedBy:e._templateHistoryEnabled()?i.InvokedBy:void 0,actionTrigger:e._templateHistoryEnabled()?i.ActionTrigger:void 0})}return n})},e.prototype.getSiteDesignStages=function(e){var t=this;return this._dataSource.getSiteDesignStages(e).then(function(n){if(n&&n.d&&n.d.GetSiteDesignStages)return t._constructSiteScriptData(n.d.GetSiteDesignStages,e)})},e.prototype.addSiteDesignTask=function(e){return this._dataSource.addSiteDesignTask(e).then(function(e){if(e&&e.d&&e.d.AddSiteDesignTaskToCurrentWeb&&e.d.AddSiteDesignTaskToCurrentWeb.ID)return{taskId:e.d.AddSiteDesignTaskToCurrentWeb.ID,siteDesignId:e.d.AddSiteDesignTaskToCurrentWeb.SiteDesignID,logonName:e.d.AddSiteDesignTaskToCurrentWeb.LogonName}})},e.prototype.getSiteDesignTasks=function(){return this._dataSource.getSiteDesignTasks().then(function(e){if(e&&e.d&&e.d.GetSiteDesignTasks&&e.d.GetSiteDesignTasks.results&&e.d.GetSiteDesignTasks.results.map)return e.d.GetSiteDesignTasks.results.map(function(e){return{taskId:e.ID,siteDesignId:e.SiteDesignID,logonName:e.LogonName}})})},e.prototype.applySiteDesign=function(e,t){return this._dataSource.applySiteDesign(e,t).then(function(e){if(e&&e.d&&e.d.ApplySiteDesign){var t=e.d.ApplySiteDesign.results;if(t){for(var n=[],a=0;a<t.length;a++){var i=t[a],r=parseInt(i.Outcome,10);n.push({outcomeCode:isNaN(r)?s.e.Failure:r,outcomeText:i.OutcomeText})}return n}}})},e.prototype.getTenantSiteDesigns=function(){var e=this;return this._dataSource.getTenantSiteDesigns().then(function(t){return e._getSiteDesignsFromServerData(t)})},e.prototype.getOutOfBoxSiteDesigns=function(){var e=this;return this._dataSource.getOutOfBoxSiteDesigns().then(function(t){return e._getSiteDesignsFromServerData(t)})},e.prototype.getOutOfBoxTemplateSettings=function(){var e=this;return this._dataSource.getOutOfBoxTemplateSettings().then(function(t){return e._getOutOfBoxTemplateSettingsFromServerData(t)})},e.prototype.getIsSiteDesignPending=function(){return this._dataSource.getIsSiteDesignPending().then(function(e){return!(!e||!e.d||e.error||!e.d.ValidatePendingWebTemplateExtension)},function(e){return!1})},e.prototype.applyImplicitSiteDesign=function(){this._dataSource.applyImplicitSiteDesign()},e.prototype._constructSiteScriptData=function(e,t){var n=JSON.parse(e),a=[],i=[];if(n&&n.recipes.length)for(var r=0;r<n.recipes.length;r++)if(a.push({id:n.recipes[r].recipeGuid,name:n.recipes[r].recipeName,actions:n.recipes[r].actions}),n.recipes[r].actions&&n.recipes[r].actions.length)for(var o=0;o<n.recipes[r].actions.length;o++)n.recipes[r].actions[o]&&n.recipes[r].actions[o].stages&&n.recipes[r].actions[o].stages.length&&i.push.apply(i,n.recipes[r].actions[o].stages);return{siteDesignId:t,siteDesignTitle:n.siteDesignTitle,siteScripts:a,stageNames:i,isLongRunning:i.length>30}},e.prototype._getSiteDesignsFromServerData=function(e){if(e&&e.d&&e.d.GetSiteDesigns){var t=e.d.GetSiteDesigns.results;if(t&&t.length){for(var n=[],a=0;a<t.length;a++){var i=t[a];if(i){var r=i.SupportedWebTemplates&&i.SupportedWebTemplates.results&&i.SupportedWebTemplates.results.length?this._getSupportedTemplateTypes(i.SupportedWebTemplates.results):this._getSupportedTemplateTypes([i.WebTemplate]),o=i.TemplateFeatures&&i.TemplateFeatures.results;n.push({id:i.Id,title:i.Title,version:i.Version,schema:void 0,imageUrl:i.PreviewImageUrl,imageAltText:i.PreviewImageAltText,description:i.Description,supportedTemplates:r,designPackageId:void 0,thumbnailUrl:i.ThumbnailUrl,templateFeatures:o,isOutOfBoxTemplate:i.IsOutOfBoxTemplate,requiresGroupConnected:i.RequiresGroupConnected,requiresTeamsConnected:i.RequiresTeamsConnected,requiresYammerConnected:i.RequiresYammerConnected,requiresClassConnected:i.RequiresClassConnected,requiresSyntexLicense:i.RequiresSyntexLicense,isTenantAdminOnly:i.IsTenantAdminOnly,order:i.Order})}}return n}}return[]},e.prototype._getOutOfBoxTemplateSettingsFromServerData=function(e){if(e&&e.d&&e.d.GetOutOfBoxSiteTemplateSettings){var t=e.d.GetOutOfBoxSiteTemplateSettings.results;if(t&&t.length){for(var n=[],a=0;a<t.length;a++){var i=t[a];i&&n.push({id:i.Id,isHidden:i.IsHidden})}return n}}return[]},e.prototype._getSupportedTemplateTypes=function(e){var t=[];if(e)for(var n=0;n<e.length;n++){var a=e[n];if(a){var i=parseInt(a,10);isNaN(i)||t.push(i)}}return t},e.prototype._templateHistoryEnabled=function(){return o.FeatureOverrides.isFeatureEnabled(u)},e}();!function(e){e[e.newProgressData=0]="newProgressData",e[e.newNonProgressData=1]="newNonProgressData",e[e.openPanelAction=2]="openPanelAction"}(a||(a={})),function(e){e[e.unknown=0]="unknown",e[e.old=1]="old",e[e.new=2]="new"}(i||(i={}));var p=function(){function e(e,t){this._totalTimeWaited=0,this._useTimerV2=!1,this._useTimerV2=!0,this._nextTimeout=8,this._lastTimeout=8}return e.prototype.getNextTimeout=function(){if(this._useTimerV2){var e=void 0;return this._totalTimeWaited>=120?(e=this._nextTimeout,this._nextTimeout=this._nextTimeout+this._lastTimeout,this._lastTimeout=e):e=8,this._totalTimeWaited+=e,1e3*e}var t=this._lastTimeout;return this._lastTimeout=this._nextTimeout,this._nextTimeout=this._nextTimeout+t,1e3*this._lastTimeout},e}(),m="00000000-0000-0000-0000-000000000000",_=m,h=function(){function e(e){var t=this;this._getSiteDesignProgress=function(e,n,r,o,s,c){if(!t.isRunComplete(n)){var d=setTimeout(t._getSiteDesignProgress.bind(t),o.getNextTimeout(),e,n,r,o,!1,c),l=!t._data[n].stageResultData||t._runCompletionStates[n].isSchemaDirty;t._provider.getSiteDesignRunStatus(e,l).then(function(e){if(e){var o=!1,s=!1;e.siteScriptData&&!e.siteScriptData.siteDesignTitle&&t._siteDesignRunDict[n]&&t._siteDesignRunDict[n].siteDesignTitle&&(e.siteScriptData.siteDesignTitle=t._siteDesignRunDict[n].siteDesignTitle);var l=t._getStageOutcomesKnownButIncomplete(e.stageResultData);e.siteScriptData&&(t._data[n].siteScriptData=e.siteScriptData,t._runCompletionStates[n].isSchemaDirty=!1,t._runCompletionStates[n].stagesRetrieved=!0,t._runCompletionStates[n].stagesRequired=e.siteScriptData.stageNames.length,o=!0),(!t._data[n].stageResultData||e.stageResultData.length>t._data[n].stageResultData.length||l<t._runCompletionStates[n].stageOutcomesKnownButIncomplete)&&(t._data[n].stageResultData=e.stageResultData,t._runCompletionStates[n].stageOutcomesKnown=e.stageResultData.length,t._runCompletionStates[n].stageOutcomesKnownButIncomplete=l,o=!0);var u=t.isRunComplete(n);t._runCompletionStates[n].age===i.unknown&&(t._runCompletionStates[n].age=u?i.old:i.new,o=!0),u&&(clearTimeout(d),t._runCompletionStates[n].age===i.new&&(t._state.hasARunCompleted=!0,s=!0)),o&&n===t._state.displayedRunKey?(t._updateState(t._runCompletionStates[n]),t._notifyListeners(a.newProgressData)):s&&t._notifyListeners(a.newProgressData)}else t._runCompletionStates[n].age===i.unknown&&(t._runCompletionStates[n].age=i.new,c&&t._getSiteDesignStages(n,r),n===t._state.displayedRunKey&&(t._updateState(t._runCompletionStates[n]),t._notifyListeners(a.newProgressData)))},function(e){t._runCompletionStates[n].age===i.unknown&&(t._runCompletionStates[n].age=i.new,c&&t._getSiteDesignStages(n,r),n===t._state.displayedRunKey&&(t._updateState(t._runCompletionStates[n]),t._notifyListeners(a.newProgressData))),404===e.status&&s&&t._provider.applyImplicitSiteDesign()})}},this._pageContext=e.pageContext,this._currentCultureName=this.getCurrentCultureName(),this._webTemplate=e.pageContext?e.pageContext.webTemplate:"",this._provider=new f({dataSource:this.createSiteScriptProgressDataSource(),currentCultureName:this._currentCultureName}),this._state={isSiteDesignPending:!1,stagesRetrieved:!1,stageOutcomesKnown:0,stageOutcomesKnownButIncomplete:0,displayedRunKey:_,stagesRequired:0,age:i.unknown,selectedTenantSiteDesign:"",hasARunCompleted:!1},this._runCompletionStates={},this._data={},this._registeredCallbacks=[],this._tenantSiteDesignsDict={},this._siteDesignRunDict={},this._siteDesignRunRequestSentDict={},this._tenantSiteDesignSchemaRequestSentDict={},this._triggeredOpenBefore=!1,e.pageContext?e.pageContext.hasPendingWebTemplateExtension?this._isSiteDesignPendingPromise=this._checkForPendingSiteDesign():this._isSiteDesignPendingPromise=Promise.resolve(!1):this._isSiteDesignPendingPromise=this._checkForPendingSiteDesign()}return e.getInstance=function(t){return e._instance||(e._instance=new e(t)),e._instance},e.prototype.createSiteScriptProgressDataSource=function(){return new l({pageContext:this._pageContext})},e.prototype.getCurrentCultureName=function(){return this._pageContext.currentCultureName},e.prototype.getWebTemplate=function(){return this._webTemplate},e.prototype.showSiteDesignRun=function(e){this._siteDesignRunDict[e]&&(this._data[e]||this._siteDesignRunRequestSentDict[e]||(this._siteDesignRunRequestSentDict[e]=!0,this._initializeRunData(e,i.unknown),this._getSiteDesignProgress(e,e,this._siteDesignRunDict[e].siteDesignId,new p(3,2),!1,!0)),this._updateState(Object(r.__assign)(Object(r.__assign)({},this._runCompletionStates[e]),{displayedRunKey:e,selectedTenantSiteDesign:"",selectedTenantSiteDesignSchema:void 0,showingTenantSiteDesigns:!1})),this._notifyListeners(a.newNonProgressData))},e.prototype.showTenantSiteDesigns=function(){this._updateState({showingTenantSiteDesigns:!0,selectedTenantSiteDesign:"",selectedTenantSiteDesignSchema:void 0}),this._notifyListeners(a.newNonProgressData)},e.prototype.hideTenantSiteDesigns=function(){this._state.showingTenantSiteDesigns&&(this._updateState({showingTenantSiteDesigns:!1,selectedTenantSiteDesign:"",selectedTenantSiteDesignSchema:void 0}),this._notifyListeners(a.newNonProgressData))},e.prototype.showTenantSiteDesign=function(e){var t=this;e?this._tenantSiteDesignsDict[e]&&(this._updateState({selectedTenantSiteDesign:e,selectedTenantSiteDesignSchema:this._tenantSiteDesignsDict[e].schema}),this._notifyListeners(a.newNonProgressData),this._tenantSiteDesignsDict[e].schema||this._tenantSiteDesignSchemaRequestSentDict[e]||(this._tenantSiteDesignSchemaRequestSentDict[e]=!0,this._provider.getSiteDesignStages(e).then(function(n){n&&(t._tenantSiteDesignsDict[e].schema=n),t._state.selectedTenantSiteDesign===e&&(t._state.selectedTenantSiteDesignSchema=t._tenantSiteDesignsDict[e].schema,t._notifyListeners(a.newNonProgressData))}))):(this._updateState({selectedTenantSiteDesign:"",selectedTenantSiteDesignSchema:void 0}),this._notifyListeners(a.newNonProgressData))},e.prototype.applySiteDesign=function(e){var t;if(this._tenantSiteDesignsDict[e]){t=this._tenantSiteDesignsDict[e];var n=Date.now().toString();this._siteDesignRunRequestSentDict[n]=!0,this._siteDesignRunDict[n]={siteDesignTitle:t.title,siteDesignId:e,runId:n,version:t.version,runDate:(new Date).toLocaleDateString(this._currentCultureName)},this._state.siteDesignRuns=Object(r.__spreadArray)([this._siteDesignRunDict[n]],this._state.siteDesignRuns,!0),this._initializeRunData(n,i.new),this._data[n].stageResultData=[],this._addSiteDesignTask(t,n),this._updateState(Object(r.__assign)(Object(r.__assign)({},this._runCompletionStates[n]),{displayedRunKey:n,showingTenantSiteDesigns:!1,selectedTenantSiteDesign:"",selectedTenantSiteDesignSchema:void 0})),this._notifyListeners(a.newNonProgressData)}},e.prototype.retrieveTenantSiteDesignsAndSiteDesignRuns=function(){var e=this;this._requestedTenantSiteDesigns||(this._requestedTenantSiteDesigns=!0,this._provider.getTenantSiteDesigns().then(function(t){o.Engagement.logData({name:"SiteScripts.GetTenantSiteDesigns",extraData:{siteDesignCount:t?t.length:0}}),e._updateState({tenantSiteDesigns:t});for(var n=0;n<t.length;n++)e._tenantSiteDesignsDict[t[n].id]=t[n];e._notifyListeners(a.newNonProgressData)})),this._getSiteDesignRuns()},e.prototype.getSiteDesignRun=function(e){return this._siteDesignRunDict[e]},e.prototype._addSiteDesignTask=function(e,t){var n=this;this._data[t].siteScriptData=e.schema,this._runCompletionStates[t].stagesRetrieved=!0,this._runCompletionStates[t].stagesRequired=this._data[t].siteScriptData.stageNames.length,this._runCompletionStates[t].isSchemaDirty=!0,this._provider.addSiteDesignTask(e.id).then(function(a){n._getSiteDesignProgress(a.taskId,t,e.id,new p(3,2),!1,!1)})},e.prototype._getSiteDesignRuns=function(){var e=this;return this._siteDesignRunsPromise||(this._siteDesignRunsPromise=this._provider.getSiteDesignRuns().then(function(t){e._updateState({siteDesignRuns:t});for(var n=0;n<t.length;n++)e._siteDesignRunDict[t[n].runId]=t[n];return e._notifyListeners(a.newNonProgressData),t})),this._siteDesignRunsPromise},e.prototype._getSiteDesignTasks=function(){return this._siteDesignTasksPromise||(this._siteDesignTasksPromise=this._provider.getSiteDesignTasks()),this._siteDesignTasksPromise},e.prototype.getState=function(){return this._state},e.prototype.getData=function(e){return this._data[e]},e.prototype.getTenantSiteDesign=function(e){return this._tenantSiteDesignsDict[e]},e.prototype.registerCallback=function(e,t,n){this._registeredCallbacks[t]||(this._registeredCallbacks[t]={}),this._registeredCallbacks[t][e]=n},e.prototype.unregisterCallback=function(e,t){var n=this._registeredCallbacks[t];n&&n.hasOwnProperty(e)&&delete n[e]},e.prototype.triggerOpenPanelAction=function(){var e=this;this._triggeredOpenBefore||(this._triggeredOpenBefore=!0,this._isSiteDesignPendingPromise.then(function(t){t||e._getSiteDesignRuns().then(function(t){if(t&&t.length){var n=t[0].runId;e._initializeRunData(n,i.unknown),e._updateState(Object(r.__assign)(Object(r.__assign)({},e._runCompletionStates[n]),{displayedRunKey:n})),e._notifyListeners(a.newNonProgressData),e._siteDesignRunRequestSentDict[n]=!0,e._getSiteDesignProgress(n,n,t[0].siteDesignId,new p(3,2),!1,!0)}})})),this._notifyListeners(a.openPanelAction)},e.prototype.isRunComplete=function(e){if(this._runCompletionStates[e]){var t=this._runCompletionStates[e];return t.stagesRetrieved&&t.stageOutcomesKnown===t.stagesRequired&&0===t.stageOutcomesKnownButIncomplete}return!1},e.prototype.getCompletionRatio=function(e){return this._data&&this._data[e]&&this._data[e].siteScriptData&&this._data[e].siteScriptData.stageNames?0===this._data[e].siteScriptData.stageNames.length?1:Math.max(0,this._state.stageOutcomesKnown-this._state.stageOutcomesKnownButIncomplete)/this._data[e].siteScriptData.stageNames.length:0},e.prototype._updateState=function(e){this._state=Object(r.__assign)(Object(r.__assign)({},this._state),e)},e.prototype._initializeRunData=function(e,t){this._runCompletionStates[e]={stagesRetrieved:!1,stageOutcomesKnown:0,stageOutcomesKnownButIncomplete:0,stagesRequired:0,age:t},this._data[e]={siteScriptData:void 0,stageResultData:void 0}},e.prototype._notifyListeners=function(e){var t=this._registeredCallbacks[e];if(t)for(var n in t)if(t.hasOwnProperty(n))try{t[n](Object(r.__assign)({},this._state))}catch(e){}},e.prototype._checkForPendingSiteDesign=function(){var e=this;return this._siteDesignRunRequestSentDict[_]=!0,this._provider.getIsSiteDesignPending().then(function(t){return t?(e._initializeRunData(_,i.unknown),e._updateState(Object(r.__assign)(Object(r.__assign)({},e._runCompletionStates[_]),{isSiteDesignPending:!0})),e._notifyListeners(a.newProgressData),e._getSiteDesignProgress(_,_,m,new p(3,2),!0,!0),!0):e._getSiteDesignTasks().then(function(t){return t.length?(e._initializeRunData(t[0].taskId,i.new),e._updateState(Object(r.__assign)(Object(r.__assign)({},e._runCompletionStates[t[0].taskId]),{displayedRunKey:t[0].taskId,displayedSiteDesignId:t[0].siteDesignId,isSiteDesignPending:!0})),e._notifyListeners(a.newProgressData),e._getSiteDesignProgress(t[0].taskId,t[0].taskId,t[0].siteDesignId,new p(3,2),!1,!0),!0):(e._updateState({canRenderWebTemplatesGalleryFirstRun:!0}),e._notifyListeners(a.newProgressData),!1)})},function(){return!1})},e.prototype._getSiteDesignStages=function(e,t){var n=this,i=this._provider.getSiteDesignStages(t);return i.then(function(t){n._data[e].siteScriptData||(n._data[e].siteScriptData=t,n._runCompletionStates[e].stagesRetrieved=!0,n._runCompletionStates[e].stagesRequired=t.stageNames.length,n._runCompletionStates[e].isSchemaDirty=!0,e===n._state.displayedRunKey&&(n._updateState(n._runCompletionStates[e]),n._notifyListeners(a.newNonProgressData)))}),i},e.prototype._getStageOutcomesKnownButIncomplete=function(e){for(var t=0,n=0;n<e.length;n++)e[n].outcomeCode===s.e.Started&&(t+=1);return t},e}()}}]);